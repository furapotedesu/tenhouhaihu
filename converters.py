# converters.py
# -----------------------------------------------
# 2025‑04‑19  空文字チェック / SyntaxError 修正
# -----------------------------------------------

# 牌の名前（萬・筒・索・字牌）
hai = [
    "一", "二", "三", "四", "五", "六", "七", "八", "九",        # 萬子
    "①", "②", "③", "④", "⑤", "⑥", "⑦", "⑧", "⑨",             # 筒子
    "1", "2", "3", "4", "5", "6", "7", "8", "9",                # 索子
    "東", "南", "西", "北", "白", "發", "中"                    # 字牌
]

# スートのサフィックス（萬・筒・索・字牌なし）
suits = ["萬"] * 9 + ["筒"] * 9 + ["索"] * 9 + [""] * 7

# 赤ドラの 136ID（萬5, 筒5, 索5 の0索目）
dora_tiles = {16, 52, 88}


def convert_tile_list(tile_str: str) -> list[str]:
    """
    136 牌 ID のカンマ区切り文字列を
    「牌名＋スート」のリストに変換して返します。

    例:
        "16,8,11"  → ["赤五索", "三索", "四索"]

    空文字列や空白だけの場合は空リストを返す。
    """
    if not tile_str.strip():            # ★ 空ならそのまま []
        return []

    tile_ids = list(map(int, tile_str.strip().split(",")))
    result   = []

    for tid in tile_ids:
        base    = tid >> 2              # 0–33 の牌種インデックス
        name    = hai[base]
        suffix  = suits[base]
        if tid in dora_tiles:
            name = "赤" + name
        result.append(name + suffix)

    return result


def convert_tile_id_to_str(tile_id: int) -> str:
    """
    単一の牌 ID（0〜135）を「牌名＋スート」に変換して返す。
    赤ドラは「赤」付きで返す。
    """
    base = tile_id >> 2
    name = hai[base]
    suffix = suits[base]
    if tile_id in dora_tiles:
        name = "赤" + name
    return name + suffix


def convert_yaku_id_to_name(yaku_ids: list[int]) -> list[str]:
    """
    役の番号リストを役名リストに変換する。
    未知のIDは「不明(ID)」として返す。
    """
    yaku_table = {
        0: "門前清自摸和", 1: "立直", 2: "一発", 3: "槍槓", 4: "嶺上開花", 5: "海底摸月", 6: "河底撈魚",
        7: "平和", 8: "断幺九", 9: "一盃口", 10: "自風 東", 11: "自風 南", 12: "自風 西", 13: "自風 北",
        14: "場風 東", 15: "場風 南", 16: "場風 西", 17: "場風 北", 18: "役牌 白", 19: "役牌 發", 20: "役牌 中",
        21: "両立直", 22: "七対子", 23: "混全帯幺九", 24: "一気通貫", 25: "三色同順", 26: "三色同刻",
        27: "三槓子", 28: "対々和", 29: "三暗刻", 30: "小三元", 31: "混老頭", 32: "二盃口", 33: "純全帯幺九",
        34: "混一色", 35: "清一色", 36: "人和", 37: "天和", 38: "地和", 39: "大三元", 40: "四暗刻",
        41: "四暗刻単騎", 42: "字一色", 43: "緑一色", 44: "清老頭", 45: "九蓮宝燈", 46: "純正九蓮宝燈",
        47: "国士無双", 48: "国士無双１３面", 49: "大四喜", 50: "小四喜", 51: "四槓子", 52: "ドラ",
        53: "裏ドラ", 54: "赤ドラ"
    }
    return [yaku_table.get(y, f"不明({y})") for y in yaku_ids]
